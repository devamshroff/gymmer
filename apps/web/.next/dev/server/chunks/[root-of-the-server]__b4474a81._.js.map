{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/devamshroff/Documents/SWE%20Career/projects/gymmer/lib/database.ts"],"sourcesContent":["// lib/database.ts\nimport { Database } from 'bun:sqlite';\nimport path from 'path';\nimport fs from 'fs';\nimport type { WorkoutSession, WorkoutExerciseLog, WorkoutCardioLog } from './types';\n\n// Database path\nconst DB_DIR = path.join(process.cwd(), 'data');\nconst DB_PATH = path.join(DB_DIR, 'gymmer.db');\n\n// Ensure data directory exists\nif (!fs.existsSync(DB_DIR)) {\n  fs.mkdirSync(DB_DIR, { recursive: true });\n}\n\n// Initialize database\nlet db: Database | null = null;\n\nexport function getDatabase(): Database {\n  if (!db) {\n    db = new Database(DB_PATH);\n    initializeDatabase(db);\n  }\n  return db;\n}\n\nfunction initializeDatabase(database: Database) {\n  const schemaPath = path.join(process.cwd(), 'lib', 'db-schema.sql');\n  const schema = fs.readFileSync(schemaPath, 'utf-8');\n\n  // Execute schema\n  database.exec(schema);\n}\n\n// Query functions\nexport function getLastWorkoutDate(workoutPlanName: string): string | null {\n  const db = getDatabase();\n  const result = db.query(`\n    SELECT date_completed\n    FROM workout_sessions\n    WHERE workout_plan_name = ?\n    ORDER BY date_completed DESC\n    LIMIT 1\n  `).get(workoutPlanName) as { date_completed: string } | null;\n\n  return result?.date_completed || null;\n}\n\nexport function createWorkoutSession(data: {\n  workout_plan_name: string;\n  date_completed: string;\n  total_duration_minutes?: number;\n  total_strain?: number;\n}): number {\n  const db = getDatabase();\n  const stmt = db.prepare(`\n    INSERT INTO workout_sessions (workout_plan_name, date_completed, total_duration_minutes, total_strain)\n    VALUES (?, ?, ?, ?)\n  `);\n\n  stmt.run(\n    data.workout_plan_name,\n    data.date_completed,\n    data.total_duration_minutes || null,\n    data.total_strain || null\n  );\n\n  return db.query('SELECT last_insert_rowid() as id').get() as any as number;\n}\n\nexport function logExercise(data: {\n  session_id: number;\n  exercise_name: string;\n  exercise_type: 'single' | 'b2b' | 'circuit';\n  warmup_weight?: number | null;\n  warmup_reps?: number | null;\n  set1_weight?: number | null;\n  set1_reps?: number | null;\n  set2_weight?: number | null;\n  set2_reps?: number | null;\n  set3_weight?: number | null;\n  set3_reps?: number | null;\n  set4_weight?: number | null;\n  set4_reps?: number | null;\n  b2b_partner_name?: string | null;\n  b2b_warmup_weight?: number | null;\n  b2b_warmup_reps?: number | null;\n  b2b_set1_weight?: number | null;\n  b2b_set1_reps?: number | null;\n  b2b_set2_weight?: number | null;\n  b2b_set2_reps?: number | null;\n  b2b_set3_weight?: number | null;\n  b2b_set3_reps?: number | null;\n  b2b_set4_weight?: number | null;\n  b2b_set4_reps?: number | null;\n}): number {\n  const db = getDatabase();\n  const stmt = db.prepare(`\n    INSERT INTO workout_exercise_logs (\n      session_id, exercise_name, exercise_type,\n      warmup_weight, warmup_reps,\n      set1_weight, set1_reps,\n      set2_weight, set2_reps,\n      set3_weight, set3_reps,\n      set4_weight, set4_reps,\n      b2b_partner_name,\n      b2b_warmup_weight, b2b_warmup_reps,\n      b2b_set1_weight, b2b_set1_reps,\n      b2b_set2_weight, b2b_set2_reps,\n      b2b_set3_weight, b2b_set3_reps,\n      b2b_set4_weight, b2b_set4_reps\n    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n  `);\n\n  stmt.run(\n    data.session_id,\n    data.exercise_name,\n    data.exercise_type,\n    data.warmup_weight ?? null, data.warmup_reps ?? null,\n    data.set1_weight ?? null, data.set1_reps ?? null,\n    data.set2_weight ?? null, data.set2_reps ?? null,\n    data.set3_weight ?? null, data.set3_reps ?? null,\n    data.set4_weight ?? null, data.set4_reps ?? null,\n    data.b2b_partner_name ?? null,\n    data.b2b_warmup_weight ?? null, data.b2b_warmup_reps ?? null,\n    data.b2b_set1_weight ?? null, data.b2b_set1_reps ?? null,\n    data.b2b_set2_weight ?? null, data.b2b_set2_reps ?? null,\n    data.b2b_set3_weight ?? null, data.b2b_set3_reps ?? null,\n    data.b2b_set4_weight ?? null, data.b2b_set4_reps ?? null\n  );\n\n  return db.query('SELECT last_insert_rowid() as id').get() as any as number;\n}\n\nexport function logCardio(data: {\n  session_id: number;\n  cardio_type: string;\n  time: string;\n}): number {\n  const db = getDatabase();\n  const stmt = db.prepare(`\n    INSERT INTO workout_cardio_logs (session_id, cardio_type, time)\n    VALUES (?, ?, ?)\n  `);\n\n  stmt.run(data.session_id, data.cardio_type, data.time);\n\n  return db.query('SELECT last_insert_rowid() as id').get() as any as number;\n}\n\nexport function getWorkoutSession(sessionId: number): (WorkoutSession & {\n  exercises: WorkoutExerciseLog[];\n  cardio: WorkoutCardioLog[];\n}) | null {\n  const db = getDatabase();\n\n  const session = db.query(`\n    SELECT * FROM workout_sessions WHERE id = ?\n  `).get(sessionId) as WorkoutSession | null;\n\n  if (!session) return null;\n\n  const exercises = db.query(`\n    SELECT * FROM workout_exercise_logs WHERE session_id = ?\n  `).all(sessionId) as WorkoutExerciseLog[];\n\n  const cardio = db.query(`\n    SELECT * FROM workout_cardio_logs WHERE session_id = ?\n  `).all(sessionId) as WorkoutCardioLog[];\n\n  return { ...session, exercises, cardio };\n}\n\nexport function getLastExerciseLog(\n  workoutPlanName: string,\n  exerciseName: string\n): WorkoutExerciseLog | null {\n  const db = getDatabase();\n  const result = db.query(`\n    SELECT el.*\n    FROM workout_exercise_logs el\n    JOIN workout_sessions ws ON el.session_id = ws.id\n    WHERE ws.workout_plan_name = ? AND el.exercise_name = ?\n    ORDER BY ws.date_completed DESC\n    LIMIT 1\n  `).get(workoutPlanName, exerciseName) as WorkoutExerciseLog | null;\n\n  return result;\n}\n\n// Close database connection (for cleanup)\nexport function closeDatabase() {\n  if (db) {\n    db.close();\n    db = null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,kBAAkB;AAClB;AACA;AACA;;;;AAGA,gBAAgB;AAChB,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACxC,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ;AAElC,+BAA+B;AAC/B,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,SAAS;IAC1B,wGAAE,CAAC,SAAS,CAAC,QAAQ;QAAE,WAAW;IAAK;AACzC;AAEA,sBAAsB;AACtB,IAAI,KAAsB;AAEnB,SAAS;IACd,IAAI,CAAC,IAAI;QACP,KAAK,IAAI,+HAAQ,CAAC;QAClB,mBAAmB;IACrB;IACA,OAAO;AACT;AAEA,SAAS,mBAAmB,QAAkB;IAC5C,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO;IACnD,MAAM,SAAS,wGAAE,CAAC,YAAY,CAAC,YAAY;IAE3C,iBAAiB;IACjB,SAAS,IAAI,CAAC;AAChB;AAGO,SAAS,mBAAmB,eAAuB;IACxD,MAAM,KAAK;IACX,MAAM,SAAS,GAAG,KAAK,CAAC,CAAC;;;;;;EAMzB,CAAC,EAAE,GAAG,CAAC;IAEP,OAAO,QAAQ,kBAAkB;AACnC;AAEO,SAAS,qBAAqB,IAKpC;IACC,MAAM,KAAK;IACX,MAAM,OAAO,GAAG,OAAO,CAAC,CAAC;;;EAGzB,CAAC;IAED,KAAK,GAAG,CACN,KAAK,iBAAiB,EACtB,KAAK,cAAc,EACnB,KAAK,sBAAsB,IAAI,MAC/B,KAAK,YAAY,IAAI;IAGvB,OAAO,GAAG,KAAK,CAAC,oCAAoC,GAAG;AACzD;AAEO,SAAS,YAAY,IAyB3B;IACC,MAAM,KAAK;IACX,MAAM,OAAO,GAAG,OAAO,CAAC,CAAC;;;;;;;;;;;;;;;EAezB,CAAC;IAED,KAAK,GAAG,CACN,KAAK,UAAU,EACf,KAAK,aAAa,EAClB,KAAK,aAAa,EAClB,KAAK,aAAa,IAAI,MAAM,KAAK,WAAW,IAAI,MAChD,KAAK,WAAW,IAAI,MAAM,KAAK,SAAS,IAAI,MAC5C,KAAK,WAAW,IAAI,MAAM,KAAK,SAAS,IAAI,MAC5C,KAAK,WAAW,IAAI,MAAM,KAAK,SAAS,IAAI,MAC5C,KAAK,WAAW,IAAI,MAAM,KAAK,SAAS,IAAI,MAC5C,KAAK,gBAAgB,IAAI,MACzB,KAAK,iBAAiB,IAAI,MAAM,KAAK,eAAe,IAAI,MACxD,KAAK,eAAe,IAAI,MAAM,KAAK,aAAa,IAAI,MACpD,KAAK,eAAe,IAAI,MAAM,KAAK,aAAa,IAAI,MACpD,KAAK,eAAe,IAAI,MAAM,KAAK,aAAa,IAAI,MACpD,KAAK,eAAe,IAAI,MAAM,KAAK,aAAa,IAAI;IAGtD,OAAO,GAAG,KAAK,CAAC,oCAAoC,GAAG;AACzD;AAEO,SAAS,UAAU,IAIzB;IACC,MAAM,KAAK;IACX,MAAM,OAAO,GAAG,OAAO,CAAC,CAAC;;;EAGzB,CAAC;IAED,KAAK,GAAG,CAAC,KAAK,UAAU,EAAE,KAAK,WAAW,EAAE,KAAK,IAAI;IAErD,OAAO,GAAG,KAAK,CAAC,oCAAoC,GAAG;AACzD;AAEO,SAAS,kBAAkB,SAAiB;IAIjD,MAAM,KAAK;IAEX,MAAM,UAAU,GAAG,KAAK,CAAC,CAAC;;EAE1B,CAAC,EAAE,GAAG,CAAC;IAEP,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,YAAY,GAAG,KAAK,CAAC,CAAC;;EAE5B,CAAC,EAAE,GAAG,CAAC;IAEP,MAAM,SAAS,GAAG,KAAK,CAAC,CAAC;;EAEzB,CAAC,EAAE,GAAG,CAAC;IAEP,OAAO;QAAE,GAAG,OAAO;QAAE;QAAW;IAAO;AACzC;AAEO,SAAS,mBACd,eAAuB,EACvB,YAAoB;IAEpB,MAAM,KAAK;IACX,MAAM,SAAS,GAAG,KAAK,CAAC,CAAC;;;;;;;EAOzB,CAAC,EAAE,GAAG,CAAC,iBAAiB;IAExB,OAAO;AACT;AAGO,SAAS;IACd,IAAI,IAAI;QACN,GAAG,KAAK;QACR,KAAK;IACP;AACF"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///Users/devamshroff/Documents/SWE%20Career/projects/gymmer/app/api/save-workout/route.ts"],"sourcesContent":["// app/api/save-workout/route.ts\nimport { NextResponse } from 'next/server';\nimport { createWorkoutSession, logExercise, logCardio } from '@/lib/database';\nimport { WorkoutSessionData } from '@/lib/workout-session';\n\nexport async function POST(request: Request) {\n  try {\n    const sessionData: WorkoutSessionData = await request.json();\n\n    // Calculate total duration in minutes\n    const startTime = new Date(sessionData.startTime);\n    const endTime = new Date();\n    const totalDurationMinutes = Math.round((endTime.getTime() - startTime.getTime()) / 60000);\n\n    // Calculate total strain (sum of all volume)\n    let totalStrain = 0;\n    for (const exercise of sessionData.exercises) {\n      if (exercise.warmup) {\n        totalStrain += exercise.warmup.weight * exercise.warmup.reps;\n      }\n      for (const set of exercise.sets) {\n        totalStrain += set.weight * set.reps;\n      }\n      if (exercise.b2bPartner) {\n        if (exercise.b2bPartner.warmup) {\n          totalStrain += exercise.b2bPartner.warmup.weight * exercise.b2bPartner.warmup.reps;\n        }\n        for (const set of exercise.b2bPartner.sets) {\n          totalStrain += set.weight * set.reps;\n        }\n      }\n    }\n\n    // Create workout session\n    const sessionId = createWorkoutSession({\n      workout_plan_name: sessionData.workoutName,\n      date_completed: endTime.toISOString(),\n      total_duration_minutes: totalDurationMinutes,\n      total_strain: Math.round(totalStrain),\n    });\n\n    // Log all exercises\n    for (const exercise of sessionData.exercises) {\n      const exerciseLog: any = {\n        session_id: sessionId,\n        exercise_name: exercise.name,\n        exercise_type: exercise.type,\n      };\n\n      // Add warmup if present\n      if (exercise.warmup) {\n        exerciseLog.warmup_weight = exercise.warmup.weight;\n        exerciseLog.warmup_reps = exercise.warmup.reps;\n      }\n\n      // Add working sets (up to 4)\n      exercise.sets.forEach((set, index) => {\n        if (index < 4) {\n          exerciseLog[`set${index + 1}_weight`] = set.weight;\n          exerciseLog[`set${index + 1}_reps`] = set.reps;\n        }\n      });\n\n      // Add B2B partner data if present\n      if (exercise.b2bPartner) {\n        exerciseLog.b2b_partner_name = exercise.b2bPartner.name;\n\n        if (exercise.b2bPartner.warmup) {\n          exerciseLog.b2b_warmup_weight = exercise.b2bPartner.warmup.weight;\n          exerciseLog.b2b_warmup_reps = exercise.b2bPartner.warmup.reps;\n        }\n\n        exercise.b2bPartner.sets.forEach((set, index) => {\n          if (index < 4) {\n            exerciseLog[`b2b_set${index + 1}_weight`] = set.weight;\n            exerciseLog[`b2b_set${index + 1}_reps`] = set.reps;\n          }\n        });\n      }\n\n      logExercise(exerciseLog);\n    }\n\n    // Log cardio if present\n    if (sessionData.cardio) {\n      logCardio({\n        session_id: sessionId,\n        cardio_type: sessionData.cardio.type,\n        time: sessionData.cardio.time,\n      });\n    }\n\n    return NextResponse.json({\n      success: true,\n      sessionId,\n      totalDurationMinutes,\n      totalStrain: Math.round(totalStrain),\n    });\n  } catch (error) {\n    console.error('Error saving workout session:', error);\n    return NextResponse.json(\n      { error: 'Failed to save workout session' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}