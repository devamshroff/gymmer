{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/devamshroff/Documents/SWE%20Career/projects/gymmer/lib/database.ts"],"sourcesContent":["// lib/database.ts\nimport { Database } from 'bun:sqlite';\nimport path from 'path';\nimport fs from 'fs';\nimport type { WorkoutSession, WorkoutExerciseLog, WorkoutCardioLog } from './types';\n\n// Database path\nconst DB_DIR = path.join(process.cwd(), 'data');\nconst DB_PATH = path.join(DB_DIR, 'gymmer.db');\n\n// Ensure data directory exists\nif (!fs.existsSync(DB_DIR)) {\n  fs.mkdirSync(DB_DIR, { recursive: true });\n}\n\n// Initialize database\nlet db: Database | null = null;\n\nexport function getDatabase(): Database {\n  if (!db) {\n    db = new Database(DB_PATH);\n    initializeDatabase(db);\n  }\n  return db;\n}\n\nfunction initializeDatabase(database: Database) {\n  const schemaPath = path.join(process.cwd(), 'lib', 'db-schema.sql');\n  const schema = fs.readFileSync(schemaPath, 'utf-8');\n\n  // Execute schema\n  database.exec(schema);\n}\n\n// Query functions\nexport function getLastWorkoutDate(workoutPlanName: string): string | null {\n  const db = getDatabase();\n  const result = db.query(`\n    SELECT date_completed\n    FROM workout_sessions\n    WHERE workout_plan_name = ?\n    ORDER BY date_completed DESC\n    LIMIT 1\n  `).get(workoutPlanName) as { date_completed: string } | null;\n\n  return result?.date_completed || null;\n}\n\nexport function createWorkoutSession(data: {\n  workout_plan_name: string;\n  date_completed: string;\n  total_duration_minutes?: number;\n  total_strain?: number;\n}): number {\n  const db = getDatabase();\n  const stmt = db.prepare(`\n    INSERT INTO workout_sessions (workout_plan_name, date_completed, total_duration_minutes, total_strain)\n    VALUES (?, ?, ?, ?)\n  `);\n\n  stmt.run(\n    data.workout_plan_name,\n    data.date_completed,\n    data.total_duration_minutes || null,\n    data.total_strain || null\n  );\n\n  return db.query('SELECT last_insert_rowid() as id').get() as any as number;\n}\n\nexport function logExercise(data: {\n  session_id: number;\n  exercise_name: string;\n  exercise_type: 'single' | 'b2b' | 'circuit';\n  warmup_weight?: number | null;\n  warmup_reps?: number | null;\n  set1_weight?: number | null;\n  set1_reps?: number | null;\n  set2_weight?: number | null;\n  set2_reps?: number | null;\n  set3_weight?: number | null;\n  set3_reps?: number | null;\n  set4_weight?: number | null;\n  set4_reps?: number | null;\n  b2b_partner_name?: string | null;\n  b2b_warmup_weight?: number | null;\n  b2b_warmup_reps?: number | null;\n  b2b_set1_weight?: number | null;\n  b2b_set1_reps?: number | null;\n  b2b_set2_weight?: number | null;\n  b2b_set2_reps?: number | null;\n  b2b_set3_weight?: number | null;\n  b2b_set3_reps?: number | null;\n  b2b_set4_weight?: number | null;\n  b2b_set4_reps?: number | null;\n}): number {\n  const db = getDatabase();\n  const stmt = db.prepare(`\n    INSERT INTO workout_exercise_logs (\n      session_id, exercise_name, exercise_type,\n      warmup_weight, warmup_reps,\n      set1_weight, set1_reps,\n      set2_weight, set2_reps,\n      set3_weight, set3_reps,\n      set4_weight, set4_reps,\n      b2b_partner_name,\n      b2b_warmup_weight, b2b_warmup_reps,\n      b2b_set1_weight, b2b_set1_reps,\n      b2b_set2_weight, b2b_set2_reps,\n      b2b_set3_weight, b2b_set3_reps,\n      b2b_set4_weight, b2b_set4_reps\n    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n  `);\n\n  stmt.run(\n    data.session_id,\n    data.exercise_name,\n    data.exercise_type,\n    data.warmup_weight ?? null, data.warmup_reps ?? null,\n    data.set1_weight ?? null, data.set1_reps ?? null,\n    data.set2_weight ?? null, data.set2_reps ?? null,\n    data.set3_weight ?? null, data.set3_reps ?? null,\n    data.set4_weight ?? null, data.set4_reps ?? null,\n    data.b2b_partner_name ?? null,\n    data.b2b_warmup_weight ?? null, data.b2b_warmup_reps ?? null,\n    data.b2b_set1_weight ?? null, data.b2b_set1_reps ?? null,\n    data.b2b_set2_weight ?? null, data.b2b_set2_reps ?? null,\n    data.b2b_set3_weight ?? null, data.b2b_set3_reps ?? null,\n    data.b2b_set4_weight ?? null, data.b2b_set4_reps ?? null\n  );\n\n  return db.query('SELECT last_insert_rowid() as id').get() as any as number;\n}\n\nexport function logCardio(data: {\n  session_id: number;\n  cardio_type: string;\n  time: string;\n}): number {\n  const db = getDatabase();\n  const stmt = db.prepare(`\n    INSERT INTO workout_cardio_logs (session_id, cardio_type, time)\n    VALUES (?, ?, ?)\n  `);\n\n  stmt.run(data.session_id, data.cardio_type, data.time);\n\n  return db.query('SELECT last_insert_rowid() as id').get() as any as number;\n}\n\nexport function getWorkoutSession(sessionId: number): (WorkoutSession & {\n  exercises: WorkoutExerciseLog[];\n  cardio: WorkoutCardioLog[];\n}) | null {\n  const db = getDatabase();\n\n  const session = db.query(`\n    SELECT * FROM workout_sessions WHERE id = ?\n  `).get(sessionId) as WorkoutSession | null;\n\n  if (!session) return null;\n\n  const exercises = db.query(`\n    SELECT * FROM workout_exercise_logs WHERE session_id = ?\n  `).all(sessionId) as WorkoutExerciseLog[];\n\n  const cardio = db.query(`\n    SELECT * FROM workout_cardio_logs WHERE session_id = ?\n  `).all(sessionId) as WorkoutCardioLog[];\n\n  return { ...session, exercises, cardio };\n}\n\nexport function getLastExerciseLog(\n  workoutPlanName: string,\n  exerciseName: string\n): WorkoutExerciseLog | null {\n  const db = getDatabase();\n  const result = db.query(`\n    SELECT el.*\n    FROM workout_exercise_logs el\n    JOIN workout_sessions ws ON el.session_id = ws.id\n    WHERE ws.workout_plan_name = ? AND el.exercise_name = ?\n    ORDER BY ws.date_completed DESC\n    LIMIT 1\n  `).get(workoutPlanName, exerciseName) as WorkoutExerciseLog | null;\n\n  return result;\n}\n\n// Close database connection (for cleanup)\nexport function closeDatabase() {\n  if (db) {\n    db.close();\n    db = null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,kBAAkB;AAClB;AACA;AACA;;;;AAGA,gBAAgB;AAChB,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACxC,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ;AAElC,+BAA+B;AAC/B,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,SAAS;IAC1B,wGAAE,CAAC,SAAS,CAAC,QAAQ;QAAE,WAAW;IAAK;AACzC;AAEA,sBAAsB;AACtB,IAAI,KAAsB;AAEnB,SAAS;IACd,IAAI,CAAC,IAAI;QACP,KAAK,IAAI,+HAAQ,CAAC;QAClB,mBAAmB;IACrB;IACA,OAAO;AACT;AAEA,SAAS,mBAAmB,QAAkB;IAC5C,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO;IACnD,MAAM,SAAS,wGAAE,CAAC,YAAY,CAAC,YAAY;IAE3C,iBAAiB;IACjB,SAAS,IAAI,CAAC;AAChB;AAGO,SAAS,mBAAmB,eAAuB;IACxD,MAAM,KAAK;IACX,MAAM,SAAS,GAAG,KAAK,CAAC,CAAC;;;;;;EAMzB,CAAC,EAAE,GAAG,CAAC;IAEP,OAAO,QAAQ,kBAAkB;AACnC;AAEO,SAAS,qBAAqB,IAKpC;IACC,MAAM,KAAK;IACX,MAAM,OAAO,GAAG,OAAO,CAAC,CAAC;;;EAGzB,CAAC;IAED,KAAK,GAAG,CACN,KAAK,iBAAiB,EACtB,KAAK,cAAc,EACnB,KAAK,sBAAsB,IAAI,MAC/B,KAAK,YAAY,IAAI;IAGvB,OAAO,GAAG,KAAK,CAAC,oCAAoC,GAAG;AACzD;AAEO,SAAS,YAAY,IAyB3B;IACC,MAAM,KAAK;IACX,MAAM,OAAO,GAAG,OAAO,CAAC,CAAC;;;;;;;;;;;;;;;EAezB,CAAC;IAED,KAAK,GAAG,CACN,KAAK,UAAU,EACf,KAAK,aAAa,EAClB,KAAK,aAAa,EAClB,KAAK,aAAa,IAAI,MAAM,KAAK,WAAW,IAAI,MAChD,KAAK,WAAW,IAAI,MAAM,KAAK,SAAS,IAAI,MAC5C,KAAK,WAAW,IAAI,MAAM,KAAK,SAAS,IAAI,MAC5C,KAAK,WAAW,IAAI,MAAM,KAAK,SAAS,IAAI,MAC5C,KAAK,WAAW,IAAI,MAAM,KAAK,SAAS,IAAI,MAC5C,KAAK,gBAAgB,IAAI,MACzB,KAAK,iBAAiB,IAAI,MAAM,KAAK,eAAe,IAAI,MACxD,KAAK,eAAe,IAAI,MAAM,KAAK,aAAa,IAAI,MACpD,KAAK,eAAe,IAAI,MAAM,KAAK,aAAa,IAAI,MACpD,KAAK,eAAe,IAAI,MAAM,KAAK,aAAa,IAAI,MACpD,KAAK,eAAe,IAAI,MAAM,KAAK,aAAa,IAAI;IAGtD,OAAO,GAAG,KAAK,CAAC,oCAAoC,GAAG;AACzD;AAEO,SAAS,UAAU,IAIzB;IACC,MAAM,KAAK;IACX,MAAM,OAAO,GAAG,OAAO,CAAC,CAAC;;;EAGzB,CAAC;IAED,KAAK,GAAG,CAAC,KAAK,UAAU,EAAE,KAAK,WAAW,EAAE,KAAK,IAAI;IAErD,OAAO,GAAG,KAAK,CAAC,oCAAoC,GAAG;AACzD;AAEO,SAAS,kBAAkB,SAAiB;IAIjD,MAAM,KAAK;IAEX,MAAM,UAAU,GAAG,KAAK,CAAC,CAAC;;EAE1B,CAAC,EAAE,GAAG,CAAC;IAEP,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,YAAY,GAAG,KAAK,CAAC,CAAC;;EAE5B,CAAC,EAAE,GAAG,CAAC;IAEP,MAAM,SAAS,GAAG,KAAK,CAAC,CAAC;;EAEzB,CAAC,EAAE,GAAG,CAAC;IAEP,OAAO;QAAE,GAAG,OAAO;QAAE;QAAW;IAAO;AACzC;AAEO,SAAS,mBACd,eAAuB,EACvB,YAAoB;IAEpB,MAAM,KAAK;IACX,MAAM,SAAS,GAAG,KAAK,CAAC,CAAC;;;;;;;EAOzB,CAAC,EAAE,GAAG,CAAC,iBAAiB;IAExB,OAAO;AACT;AAGO,SAAS;IACd,IAAI,IAAI;QACN,GAAG,KAAK;QACR,KAAK;IACP;AACF"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///Users/devamshroff/Documents/SWE%20Career/projects/gymmer/app/api/workout-history/route.ts"],"sourcesContent":["// app/api/workout-history/route.ts\nimport { NextResponse } from 'next/server';\nimport { getLastWorkoutDate } from '@/lib/database';\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const workoutName = searchParams.get('name');\n\n    if (!workoutName) {\n      return NextResponse.json(\n        { error: 'Workout name is required' },\n        { status: 400 }\n      );\n    }\n\n    const lastDate = getLastWorkoutDate(workoutName);\n\n    return NextResponse.json({ lastDate });\n  } catch (error) {\n    console.error('Error fetching workout history:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch workout history' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA,mCAAmC;AACnC;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,cAAc,aAAa,GAAG,CAAC;QAErC,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,IAAA,uIAAkB,EAAC;QAEpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAS;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAkC,GAC3C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}