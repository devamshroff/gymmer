{"version":3,"sources":["../../../lib/auth-utils.ts"],"sourcesContent":["// lib/auth-utils.ts\n// Helper utilities for authentication in API routes\n\nimport { auth } from \"@/auth\"\nimport { NextResponse } from \"next/server\"\n\nexport interface AuthenticatedUser {\n  id: string\n  email: string\n  name?: string | null\n  image?: string | null\n}\n\n/**\n * Get the current authenticated user from the session.\n * Returns null if not authenticated.\n */\nexport async function getCurrentUser(): Promise<AuthenticatedUser | null> {\n  const session = await auth()\n\n  if (!session?.user?.email) {\n    return null\n  }\n\n  return {\n    id: session.user.email, // We use email as the user ID\n    email: session.user.email,\n    name: session.user.name,\n    image: session.user.image,\n  }\n}\n\n/**\n * Require authentication for an API route.\n * Returns the user if authenticated, or a 401 response if not.\n */\nexport async function requireAuth(): Promise<\n  { user: AuthenticatedUser } | { error: NextResponse }\n> {\n  if (process.env.E2E_TEST === \"1\") {\n    return {\n      user: {\n        id: \"e2e@test.local\",\n        email: \"e2e@test.local\",\n        name: \"E2E User\",\n      },\n    }\n  }\n\n  const user = await getCurrentUser()\n\n  if (!user) {\n    return {\n      error: NextResponse.json(\n        { error: \"Unauthorized\" },\n        { status: 401 }\n      ),\n    }\n  }\n\n  return { user }\n}\n"],"names":[],"mappings":"o1CAGA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,gBAaO,eAAe,IACpB,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,IAAA,AAAI,WAE1B,AAAK,GAAS,CAAV,KAAgB,MAIb,CAJoB,AAKzB,GAAI,EAAQ,IAAI,CAAC,KAAK,CACtB,MAAO,EAAQ,IAAI,CAAC,KAAK,CACzB,KAAM,EAAQ,IAAI,CAAC,IAAI,CACvB,MAAO,EAAQ,IAAI,CAAC,KAAK,AAC3B,EARS,IASX,CAMO,eAAe,IAGpB,GAA6B,KAAK,CAA9B,QAAQ,GAAG,CAAC,QAAQ,CACtB,MAAO,CACL,KAAM,CACJ,GAAI,iBACJ,MAAO,iBACP,KAAM,UACR,CACF,EAGF,IAAM,EAAO,MAAM,WAEnB,AAAK,EASE,CAAE,CATL,EAAO,GASG,EARL,CACL,MAAO,EAAA,YAAY,CAAC,IAAI,CACtB,CAAE,MAAO,cAAe,EACxB,CAAE,OAAQ,GAAI,EAElB,CAIJ"}